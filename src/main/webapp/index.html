<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>主页</title>
		<link rel="shortcut icon" type="image/x-icon" href="static/img/64535.ico">
		<link href="static/css/bootstrap.min.css" rel="stylesheet" />
		<link href="static/css/index.css" rel="stylesheet" />
		<link href="static/css/bootstrap-responsive.css" rel="stylesheet" />

	</head>

	<body>
			<!--导航栏-->
			<div id="header"></div>

			<div id="main">
				<!--轮播图-->
				<div id="myCarousel" class="carousel slide">
					<!-- 轮播（Carousel）指标 -->
					<ol class="carousel-indicators">
						<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
						<li data-target="#myCarousel" data-slide-to="1"></li>
						<li data-target="#myCarousel" data-slide-to="2"></li>
					</ol>
					<!-- 轮播（Carousel）项目 -->
					<div class="carousel-inner">
						<div class="item active">
							<img src="static/img/cover_bg_1.jpg" class="img-responsive" alt="First slide">
							<div class="carousel-caption">图片1</div>
						</div>
						<div class="item">
							<img src="static/img/cover_bg_2.jpg" class="img-responsive" alt="Second slide">
							<div class="carousel-caption">图片 2</div>
						</div>
						<div class="item">
							<img src="static/img/cover_bg_3.jpg" class="img-responsive" alt="Third slide">
							<div class="carousel-caption">图片3</div>
						</div>
					</div>
					<!-- 轮播（Carousel）导航 -->
					<a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
					<a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
				</div>
				
				<div></div>
				
				
				<!--折叠内容-->
				<div id="banner">
					<div class="panel-group" id="accordion">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h4 class="panel-title">
				<a data-toggle="collapse" data-parent="#accordion" 
				   href="#collapseOne">
					点击我进行展开，再次点击我进行折叠。第 1 部分
				</a>
			</h4>
							</div>
							<div id="collapseOne" class="panel-collapse collapse in">
								<div class="panel-body">
									Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo.
								</div>
							</div>
						</div>
					</div>

					<button type="button" class="btn btn-primary" data-toggle="collapse" data-target="#demo">
	简单的可折叠组件
</button>

					<div id="demo" class="collapse in">
						<table class="table">
					<caption>用户信息列表</caption>
					<thead>
						<tr class="bg-primary">
							<th>编号</th>
							<th>用户名</th>
							<th>邮箱</th>
							<th>手机号</th>
							<th>身份证</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody  id="tbody-list">
					</tbody>
				</table>
					</div>
				</div>

				
					
					
				<!-- <ul class="pagination next">
					<li><a href="#">上一页</a></li>
					<li><a href="#">1</a></li>
					<li><a href="#">2</a></li>
					<li><a href="#">3</a></li>
					<li><a href="#">4</a></li>
					<li><a href="#">5</a></li>
					<li><a href="#">下一页</a></li>
				</ul><br> -->
			</div>

			<div>
				<a href="#" class="list-group-item active">
	免费域名注册
</a>
				<a href="#" class="list-group-item">24*7 支持</a>
				<a href="#" class="list-group-item">免费 Window 空间托管</a>
				<a href="#" class="list-group-item">图像的数量</a>
				<a href="#" class="list-group-item">每年更新成本</a>
			</div>
			
			
			<div id="footer">

				<div>
					<div class="panel panel-primary">
						<div class="panel-heading">
							<h3 class="panel-title">面板标题</h3>
						</div>
						<div class="panel-body">
							这是一个基本的面板
						</div>
					</div>
					<div class="panel panel-success">
						<div class="panel-heading">
							<h3 class="panel-title">面板标题</h3>
						</div>
						<div class="panel-body">
							这是一个基本的面板
						</div>
					</div>
					<div class="panel panel-info">
						<div class="panel-heading">
							<h3 class="panel-title">面板标题</h3>
						</div>
						<div class="panel-body">
							这是一个基本的面板
						</div>
					</div>
					<div class="panel panel-warning">
						<div class="panel-heading">
							<h3 class="panel-title">面板标题</h3>
						</div>
						<div class="panel-body">
							这是一个基本的面板 
							<a data-toggle="modal" href="#myModal">aa</a>
					<div id="myModal" class="modal fade" tabindex="-1">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<a class="close" data-dismiss="modal">×</a>
									<h3>对话框标题</h3>
								</div>
								<div class="modal-body">
									<p>对话框内容</p>
								</div>
								<div class="modal-footer">
									<a data-toggle="modal" data-dismiss="modal" class="btn">关闭</a> <a href="#"
										class="btn btn-primary">保存更新</a>
								</div>
							</div>
						</div>
					</div>

				</div>
					</div>
					<div class="panel panel-danger">
						<div class="panel-heading">
							<h3 class="panel-title">带表格的面板</h3>
						</div>
						<table class="table">
							<thead>
								<tr>
									<th>产品</th>
									<th>付款日期</th>
									<th>状态</th>
								</tr>
							</thead>
							<tbody>
								<tr class="active">
									<td>产品1</td>
									<td>23/11/2013</td>
									<td>待发货</td>
								</tr>
								<tr class="success">
									<td>产品2</td>
									<td>10/11/2013</td>
									<td>发货中</td>
								</tr>
								<tr class="warning">
									<td>产品3</td>
									<td>20/10/2013</td>
									<td>待确认</td>
								</tr>
								<tr class="danger">
									<td>产品4</td>
									<td>20/10/2013</td>
									<td>已退货</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		
		<!--返回顶部-->
		<!-- <div id="return-top" class="navbar-fixed-bottom">
			<a href="#header" class="back-to-top navbar-right"><img id="return" src="static/img/totop2.png" alt="返回顶部" /> </a>
		</div> -->

		<script src="static/js/jquery-3.2.0.min.js"></script>
		<script src="static/js/bootstrap.min.js"></script>
		<script src="static/js/UserController/loginModal.js"></script>
		<script src="static/js/UserController/registerModal.js"></script>
		<script src="static/js/UserController/userInfoModal.js"></script>
		<script src="static/js/UserController/aboutUsModal.js"></script>
		<script src="static/js/UserController/userLogin.js"></script>
		<script src="static/js/UserController/userRegister.js"></script>
		<script src="static/js/UserController/userUpdate.js"></script>
		<script src="static/js/UserController/aboutUs.js"></script>
		<script src="static/js/layer.js"></script>
		<script src="http://cdn.bootcss.com/blueimp-md5/1.1.0/js/md5.min.js"></script>
		<script>
		var userList = $('#tbody-list')
		var isFirst=true,
			pageSize=5,
			page=1,
			totalPage=0;
			
			$(function() {
				$('.carousel').carousel({
					interval: 3500
				});
				$("#header").load("header.html");
				getLoginedUser()
				getUsers(pageSize,page)
				
			});
			
			function getUsers(pageSize,page){
				if(page==0){
					return;
				}
				if(!isFirst){//判断是否首次加载
					if(totalPage<page){
        				layer.msg('再点也没用!^_^');
        				page--
        				return;
        			}
				}
				
				$.ajax({
                type:'GET',
                url: 'index/page?pageSize='+pageSize+'&page='+page,
                dataType:'json',
                success:function(result){
                		userList.empty()
                		if (result.code==0) {
                			if(result.data !=null && result.data.length > 0){
                				isFirst=false;
                				totalPage=result.totalPage;//总页数
                            $.each(result.data, function(i, item){
                              userList.append(
                                    '<tr>\
                                    <td class="active">'+item.id+'</td>\
                                    <td class="success">'+item.username+'</td>\
                                    <td class="warning">'+item.email+'</td>\
                                    <td class="active">'+item.phone+'</td>\
                                    <td class="danger">'+item.idCard+'</td>\
                                    <td class="active"><a href="javascript:;" onclick="delUser('+item.id+',this)">删除</a>\
                                    <a href="javascript:;"  onclick="getUserInfo('+item.id+')">详细</a></td>\
                                	</tr>'
                               )  
                            })
                            userList.append(
                            		'<tr style="text-align: right;">\
                                    <td colspan="6"><ul class="pagination next">\
                                    <li>每页显示</li>\
                                    <li><select id="pageSize" onchange="changePageSize()" style="width:auto;">\
                                    <option>'+pageSize+'</option>\
                                    <option>5</option>\
                                    <option>10</option>\
                                    <option>25</option>\
                                    <option>50</option>\
                                    <option>100</option>\
                                  	</select></li>\
                                  	<li>条记录</li>\
                                    <li><a href="javascript:;" onclick="getUsers('+pageSize+',1)">首页</a></li>\
                                    <li><a href="javascript:;" onclick="getUsers('+pageSize+','+(page - 1)+')">上一页</a></li>\
                                    <li><a href="javascript:;" onclick="getUsers('+pageSize+','+(page + 1)+')">下一页</a></li>\
                                    <li><a href="javascript:;" onclick="getUsers('+pageSize+','+result.totalPage+')">尾页</a></li>\
                                	</ul></td></tr>'
                            		)
                        } else {
                           userList.append('<tr><td colspan="5" style="text-align:center">没有数据</td></tr>')
                        }
                		}else {
                           userList.append('<tr><td colspan="5" style="text-align:center">获取数据失败</td></tr>')
                        }
                	}
                })};
                
                function changePageSize(){
                	pageSize=$('#pageSize').val()
                	getUsers(pageSize,1)
                	window.location.href = "#collapseOne";
                }
               
			
			function delUser(user_id, row) {
				layer.confirm('确定要删除该行信息?', {
					shadeClose : true,
					btn : [ '确定', '取消' ]
				}, function() {
					$.ajax({
						type : 'get',
						url : 'index/de/' + user_id,
						dataType : 'json',
						success : function(result) {
							if (result.code == 0) {
								getDel(row)
							} else {
								layer.msg(result.msg);
							}
						}
					})
					layer.closeAll()
				})
			};

			function getDel(k) {
				$(k).parent().parent().remove();
			};

			function getUserInfo(user_id) {
				$.ajax({
					type : 'POST',
					url : 'index/userInfo',
					data : {
						'id' : user_id
					},
					dataType : 'json',
					success : function(result) {
						if (result.code == 0) {
							var data = result.data
							$('#user_id').val(data.id)
							$('#uname').val(data.username)
							$('#upassword').val(data.password)
							$('#uemail').val(data.email)
							$('#uphone').val(data.phone)
							$('#utype').val(data.type)
							$('#uidcard').val(data.idCard)
							$('#ucreateDate').val(data.createDate)
							$('#uupdateDate').val(data.updateDate)
							$("#userInfoW").modal('show')
						} else {
							layer.msg(result.msg);
						}
					}
				})
			};

			function getLoginedUser() {
				$.ajax({
					type : 'get',
					url : 'index/user',
					dataType : 'json',
					success : function(result) {
						if (result.code == 0) {
							if (result.data != null) {
								$('#userLogined').text(result.data.username)
							} else {
								layer.msg('请登录!')
								setTimeout(function() {
									window.location.href = 'login.html';
								}, 1000);
							}

						} else {
							layer.msg('请登录!')
							setTimeout(function() {
								window.location.href = 'login.html';
							}, 1000);
						}
					}
				})
			};

			function clearAll() {
				layer.confirm('确定要注销当前用户?', {
					shadeClose : true,
					btn : [ '确定', '取消' ]
				}, function() {
					$.ajax({
						type : 'get',
						url : 'index/clearAll',
						dataType : 'json',
						success : function(result) {
							if (result.code == 0) {
								$('#userLogined').text("请登录")
								window.location.href = "login.html";
							}
						}
					})
					layer.closeAll()
				});
			};
		</script>
	</body>

</html>